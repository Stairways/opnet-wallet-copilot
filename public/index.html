<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OP_NET Wallet Copilot</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f;
    --surface: #111118;
    --surface2: #1a1a24;
    --border: #2a2a3a;
    --orange: #f7931a;
    --orange-dim: rgba(247,147,26,0.12);
    --orange-glow: rgba(247,147,26,0.3);
    --green: #00e5a0;
    --green-dim: rgba(0,229,160,0.10);
    --red: #ff4d6a;
    --text: #e8e8f0;
    --muted: #6b6b88;
    --accent: #a78bfa;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Syne', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(247,147,26,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(247,147,26,0.03) 1px, transparent 1px);
    background-size: 48px 48px;
    pointer-events: none;
    z-index: 0;
  }
  .container { max-width: 900px; margin: 0 auto; padding: 40px 24px; position: relative; z-index: 1; }

  header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 48px; animation: fadeDown 0.6s ease both; }
  .logo { display: flex; align-items: center; gap: 12px; }
  .logo-icon { width: 40px; height: 40px; background: var(--orange); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; box-shadow: 0 0 24px var(--orange-glow); }
  .logo-text { font-size: 20px; font-weight: 800; letter-spacing: -0.5px; }
  .logo-text span { color: var(--orange); }

  .network-badge { font-family: 'Space Mono', monospace; font-size: 11px; padding: 6px 12px; border-radius: 20px; letter-spacing: 1px; }
  .network-badge.connected { background: var(--green-dim); color: var(--green); border: 1px solid rgba(0,229,160,0.2); }
  .network-badge.disconnected { background: rgba(255,77,106,0.1); color: var(--red); border: 1px solid rgba(255,77,106,0.2); }
  .network-badge.connecting { background: var(--orange-dim); color: var(--orange); border: 1px solid rgba(247,147,26,0.2); }
  .network-badge::before { content: 'â— '; animation: pulse 2s infinite; }
  @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

  .input-section { margin-bottom: 40px; animation: fadeUp 0.6s 0.1s ease both; }
  .input-label { font-size: 12px; font-weight: 600; color: var(--muted); letter-spacing: 2px; text-transform: uppercase; margin-bottom: 10px; display: block; }
  .input-row { display: flex; gap: 12px; }
  .address-input { flex: 1; background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 14px 18px; font-family: 'Space Mono', monospace; font-size: 13px; color: var(--text); outline: none; transition: border-color 0.2s, box-shadow 0.2s; }
  .address-input:focus { border-color: var(--orange); box-shadow: 0 0 0 3px var(--orange-dim); }
  .address-input::placeholder { color: var(--muted); }

  .btn { background: var(--orange); color: #000; border: none; border-radius: 12px; padding: 14px 24px; font-family: 'Syne', sans-serif; font-size: 14px; font-weight: 700; cursor: pointer; transition: transform 0.15s, box-shadow 0.15s; white-space: nowrap; }
  .btn:hover { transform: translateY(-1px); box-shadow: 0 8px 24px var(--orange-glow); }
  .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
  .btn-ghost { background: var(--surface); color: var(--text); border: 1px solid var(--border); }
  .btn-ghost:hover { border-color: var(--orange); box-shadow: none; }

  .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 32px; animation: fadeUp 0.6s 0.2s ease both; }
  .stat-card { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 24px; position: relative; overflow: hidden; transition: border-color 0.2s, transform 0.2s; }
  .stat-card:hover { border-color: var(--orange); transform: translateY(-2px); }
  .stat-card::after { content: ''; position: absolute; top: 0; right: 0; width: 80px; height: 80px; background: radial-gradient(circle at top right, var(--orange-dim), transparent 70%); border-radius: 0 16px 0 80px; }
  .stat-label { font-size: 11px; font-weight: 600; color: var(--muted); letter-spacing: 2px; text-transform: uppercase; margin-bottom: 10px; }
  .stat-value { font-family: 'Space Mono', monospace; font-size: 26px; font-weight: 700; color: var(--text); line-height: 1; margin-bottom: 6px; }
  .stat-value.btc { color: var(--orange); }
  .stat-value.green { color: var(--green); }
  .stat-sub { font-size: 12px; color: var(--muted); }

  .main-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px; }
  .section { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; overflow: hidden; }
  .section.animate { animation: fadeUp 0.6s 0.3s ease both; }
  .section-header { display: flex; align-items: center; gap: 10px; padding: 20px 24px; border-bottom: 1px solid var(--border); }
  .section-icon { width: 28px; height: 28px; background: var(--orange-dim); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px; }
  .section-title { font-size: 14px; font-weight: 700; }

  /* Chat */
  .chat-messages { padding: 20px 24px; min-height: 220px; max-height: 280px; overflow-y: auto; display: flex; flex-direction: column; gap: 14px; }
  .msg { display: flex; gap: 10px; animation: fadeUp 0.3s ease both; }
  .msg-avatar { width: 28px; height: 28px; border-radius: 8px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; font-size: 13px; margin-top: 2px; }
  .msg.bot .msg-avatar { background: linear-gradient(135deg, var(--orange), #ff6b35); }
  .msg.user .msg-avatar { background: var(--surface2); border: 1px solid var(--border); }
  .msg-bubble { background: var(--surface2); border-radius: 12px; border-top-left-radius: 4px; padding: 10px 14px; font-size: 13px; line-height: 1.6; max-width: calc(100% - 38px); }
  .msg.user .msg-bubble { background: var(--orange-dim); border: 1px solid rgba(247,147,26,0.15); border-top-left-radius: 12px; border-top-right-radius: 4px; margin-left: auto; }
  .msg.user { flex-direction: row-reverse; }
  .highlight { color: var(--orange); font-weight: 700; }
  .good { color: var(--green); }
  .warn { color: #fbbf24; }

  .suggestions { padding: 0 20px 16px; display: flex; gap: 8px; flex-wrap: wrap; }
  .chip { font-size: 11px; padding: 5px 10px; border-radius: 20px; background: var(--surface2); border: 1px solid var(--border); color: var(--muted); cursor: pointer; transition: all 0.15s; font-family: 'Syne', sans-serif; }
  .chip:hover { border-color: var(--orange); color: var(--orange); }

  .chat-input-row { padding: 16px 20px; border-top: 1px solid var(--border); display: flex; gap: 10px; }
  .chat-input { flex: 1; background: var(--surface2); border: 1px solid var(--border); border-radius: 10px; padding: 10px 14px; font-family: 'Syne', sans-serif; font-size: 13px; color: var(--text); outline: none; }
  .chat-input:focus { border-color: var(--orange); }
  .chat-input::placeholder { color: var(--muted); font-size: 12px; }
  .send-btn { background: var(--orange); border: none; border-radius: 10px; width: 38px; height: 38px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px; color: #000; transition: transform 0.15s; }
  .send-btn:hover { transform: scale(1.05); }

  /* Tokens */
  .token-row { display: flex; align-items: center; padding: 14px 24px; gap: 14px; cursor: pointer; transition: background 0.15s; border-bottom: 1px solid var(--border); }
  .token-row:last-child { border-bottom: none; }
  .token-row:hover { background: var(--surface2); }
  .token-icon { width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0; font-weight: 700; font-family: 'Space Mono', monospace; }
  .token-info { flex: 1; }
  .token-name { font-size: 14px; font-weight: 600; margin-bottom: 2px; }
  .token-type { font-size: 11px; color: var(--muted); }
  .token-bal { font-family: 'Space Mono', monospace; font-size: 14px; font-weight: 700; margin-bottom: 2px; text-align: right; }
  .token-usd { font-size: 11px; color: var(--muted); text-align: right; }

  /* Activity */
  .full-width { grid-column: 1 / -1; }
  .activity-row { display: flex; align-items: center; padding: 14px 24px; gap: 16px; border-bottom: 1px solid var(--border); transition: background 0.15s; }
  .activity-row:last-child { border-bottom: none; }
  .activity-row:hover { background: var(--surface2); }
  .activity-dot { width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0; }
  .activity-dot.send { background: rgba(255,77,106,0.1); }
  .activity-dot.recv { background: var(--green-dim); }
  .activity-dot.contract { background: rgba(167,139,250,0.1); }
  .activity-info { flex: 1; }
  .activity-title { font-size: 13px; font-weight: 600; margin-bottom: 3px; }
  .activity-desc { font-family: 'Space Mono', monospace; font-size: 11px; color: var(--muted); word-break: break-all; }
  .activity-meta { text-align: right; }
  .activity-amount { font-family: 'Space Mono', monospace; font-size: 13px; font-weight: 700; margin-bottom: 3px; }
  .activity-amount.neg { color: var(--red); }
  .activity-amount.pos { color: var(--green); }
  .activity-time { font-size: 11px; color: var(--muted); }
  .proof-badge { font-size: 10px; background: rgba(167,139,250,0.1); color: var(--accent); border: 1px solid rgba(167,139,250,0.2); padding: 2px 7px; border-radius: 4px; font-family: 'Space Mono', monospace; }

  /* Loading */
  .loading-row { padding: 32px; text-align: center; color: var(--muted); font-size: 13px; }
  .spinner { display: inline-block; width: 20px; height: 20px; border: 2px solid var(--border); border-top-color: var(--orange); border-radius: 50%; animation: spin 0.8s linear infinite; margin-bottom: 8px; }
  @keyframes spin { to { transform: rotate(360deg); } }

  .typing { display: flex; align-items: center; gap: 4px; padding: 4px 0; }
  .typing span { width: 6px; height: 6px; background: var(--orange); border-radius: 50%; animation: bounce 1.2s infinite; }
  .typing span:nth-child(2) { animation-delay: 0.2s; }
  .typing span:nth-child(3) { animation-delay: 0.4s; }
  @keyframes bounce { 0%, 80%, 100% { transform: translateY(0); opacity: 0.4; } 40% { transform: translateY(-5px); opacity: 1; } }

  .error-banner { background: rgba(255,77,106,0.1); border: 1px solid rgba(255,77,106,0.3); border-radius: 12px; padding: 14px 18px; font-size: 13px; color: var(--red); margin-bottom: 16px; display: none; }

  @keyframes fadeDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

  @media (max-width: 640px) {
    .stats-grid { grid-template-columns: 1fr 1fr; }
    .main-grid { grid-template-columns: 1fr; }
    .stat-card:last-child { grid-column: 1 / -1; }
  }
</style>
</head>
<body>
<div class="container">

  <header>
    <div class="logo">
      <div class="logo-icon">â‚¿</div>
      <div>
        <div class="logo-text"><span>OP_NET</span> Wallet Copilot</div>
      </div>
    </div>
    <div class="network-badge connecting" id="networkBadge">CONNECTING...</div>
  </header>

  <div class="error-banner" id="errorBanner"></div>

  <div class="input-section">
    <label class="input-label">Bitcoin / OP_NET Testnet Address</label>
    <div class="input-row">
      <input class="address-input" id="addressInput" type="text"
        placeholder="tb1p... (OP_NET testnet Taproot address)"
      />
      <button class="btn" id="analyzeBtn" onclick="analyzeWallet()">Analyze â†’</button>
      <button class="btn btn-ghost" onclick="loadDemo()">Demo</button>
    </div>
  </div>

  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-label">BTC Balance</div>
      <div class="stat-value btc" id="btcBal">â€”</div>
      <div class="stat-sub" id="btcSub">Enter an address above</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">OP_20 Tokens</div>
      <div class="stat-value green" id="tokenCount">â€”</div>
      <div class="stat-sub">Active positions</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Transactions</div>
      <div class="stat-value" id="txCount">â€”</div>
      <div class="stat-sub">On OP_NET testnet</div>
    </div>
  </div>

  <div class="main-grid">

    <!-- AI Copilot -->
    <div class="section animate">
      <div class="section-header">
        <div class="section-icon">ğŸ¤–</div>
        <div class="section-title">AI Copilot</div>
      </div>
      <div class="chat-messages" id="chatMessages">
        <div class="msg bot">
          <div class="msg-avatar">â‚¿</div>
          <div class="msg-bubble">
            Hey! Enter a Bitcoin testnet address above and I'll analyze it for you â€” balance, tokens, transaction history, all cryptographically verified on OP_NET. ğŸ”
          </div>
        </div>
      </div>
      <div class="suggestions" id="suggestions">
        <div class="chip" onclick="askQ('What are OP_20 tokens?')">ğŸ’¡ What is OP_20?</div>
        <div class="chip" onclick="askQ('How does OP_NET verify transactions?')">ğŸ”’ How OP_NET works</div>
        <div class="chip" onclick="askQ('What is a Taproot address?')">â‚¿ Taproot addresses</div>
      </div>
      <div class="chat-input-row">
        <input class="chat-input" id="chatInput" placeholder="Ask anything about this wallet..." onkeydown="if(event.key==='Enter') sendMsg()" />
        <button class="send-btn" onclick="sendMsg()">â†’</button>
      </div>
    </div>

    <!-- Tokens -->
    <div class="section animate">
      <div class="section-header">
        <div class="section-icon">ğŸª™</div>
        <div class="section-title">OP_20 Token Holdings</div>
      </div>
      <div id="tokenList">
        <div class="loading-row">Enter an address to see tokens</div>
      </div>
    </div>

    <!-- Activity - full width -->
    <div class="section full-width" style="animation: fadeUp 0.6s 0.4s ease both;">
      <div class="section-header">
        <div class="section-icon">âš¡</div>
        <div class="section-title">Recent Transactions</div>
        <span class="proof-badge" style="margin-left:auto;">âœ“ CRYPTOGRAPHIC PROOF</span>
      </div>
      <div id="activityList">
        <div class="loading-row">Enter an address to see transaction history</div>
      </div>
    </div>

  </div>
</div>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CONFIG â€” where our backend server lives
// When you deploy to Vercel, this will be your live URL
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const API_BASE = window.location.origin; // same server as frontend

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CHECK NETWORK STATUS on page load
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function checkStatus() {
  try {
    const res = await fetch(`${API_BASE}/api/status`);
    const data = await res.json();
    const badge = document.getElementById('networkBadge');
    if (data.connected) {
      badge.className = 'network-badge connected';
      badge.textContent = `TESTNET Â· BLOCK ${data.latestBlock}`;
    } else {
      badge.className = 'network-badge disconnected';
      badge.textContent = 'DISCONNECTED';
    }
  } catch {
    const badge = document.getElementById('networkBadge');
    badge.className = 'network-badge disconnected';
    badge.textContent = 'SERVER OFFLINE';
  }
}

checkStatus();
setInterval(checkStatus, 30000); // refresh every 30 sec

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// MAIN: ANALYZE WALLET
// Called when user clicks "Analyze â†’"
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function analyzeWallet() {
  const address = document.getElementById('addressInput').value.trim();
  if (!address) { showError('Please enter a Bitcoin address first.'); return; }

  hideError();
  setLoading(true);

  // Clear old data
  document.getElementById('btcBal').textContent = '...';
  document.getElementById('tokenCount').textContent = '...';
  document.getElementById('txCount').textContent = '...';
  document.getElementById('tokenList').innerHTML = '<div class="loading-row"><div class="spinner"></div><br>Loading tokens...</div>';
  document.getElementById('activityList').innerHTML = '<div class="loading-row"><div class="spinner"></div><br>Loading transactions...</div>';

  // Tell the copilot we're loading
  clearChat();
  addMsg('bot', `Analyzing wallet <span class="highlight">${shortAddr(address)}</span> on OP_NET testnet...`);

  try {
    // Fetch balance, tokens, and transactions in parallel (all at the same time)
    const [balanceData, tokenData, txData] = await Promise.all([
      fetch(`${API_BASE}/api/balance/${address}`).then(r => r.json()),
      fetch(`${API_BASE}/api/tokens/${address}`).then(r => r.json()),
      fetch(`${API_BASE}/api/transactions/${address}`).then(r => r.json()),
    ]);

    // Update stats
    const btcBal = balanceData.error ? '0.00000000' : balanceData.balanceBTC;
    document.getElementById('btcBal').textContent = parseFloat(btcBal).toFixed(5);
    document.getElementById('btcSub').textContent = `â‰ˆ $${(parseFloat(btcBal) * 98000).toLocaleString()} est.`;
    document.getElementById('tokenCount').textContent = tokenData.tokens?.length ?? 0;
    document.getElementById('txCount').textContent = txData.transactions?.length ?? 0;

    // Render tokens
    renderTokens(tokenData.tokens || []);

    // Render transactions
    renderTransactions(txData.transactions || []);

    // Copilot summary
    const fallback = balanceData.fallback || txData.fallback;
    const btcDisplay = parseFloat(btcBal).toFixed(5);
    const tokenCount = tokenData.tokens?.length ?? 0;
    const txCount = txData.transactions?.length ?? 0;

    if (fallback) {
      addMsg('bot', `I connected to OP_NET but this address may not have activity on testnet yet â€” or OP_NET's node returned an error. <span class="warn">Try a different address, or check that you're using a testnet address (starts with tb1).</span>`);
    } else {
      addMsg('bot', `Wallet loaded! I found <span class="highlight">${btcDisplay} BTC</span>${tokenCount > 0 ? ` and ${tokenCount} OP_20 token position${tokenCount !== 1 ? 's' : ''}` : ''} with ${txCount} transaction${txCount !== 1 ? 's' : ''} â€” all cryptographically verified on OP_NET. <span class="good">âœ“ Proof of correct execution confirmed.</span> What would you like to know?`);
    }

  } catch (err) {
    showError(`Could not reach the OP_NET server. Make sure "npm start" is running. (${err.message})`);
    addMsg('bot', `<span class="warn">âš  I couldn't connect to the OP_NET server. Make sure the app is running with "npm start".</span>`);
  }

  setLoading(false);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// RENDER: TOKEN LIST
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderTokens(tokens) {
  const el = document.getElementById('tokenList');
  if (!tokens.length) {
    el.innerHTML = '<div class="loading-row">No OP_20 tokens found for this address</div>';
    return;
  }
  el.innerHTML = tokens.map(t => `
    <div class="token-row">
      <div class="token-icon" style="background:${t.color || '#f7931a'}22; color:${t.color || '#f7931a'};">
        ${t.symbol?.[0] || '?'}
      </div>
      <div class="token-info">
        <div class="token-name">${t.name}</div>
        <div class="token-type">OP_20 Â· ${t.symbol}</div>
      </div>
      <div>
        <div class="token-bal">${Number(t.balance).toLocaleString()}</div>
        <div class="token-usd">${t.symbol}</div>
      </div>
    </div>
  `).join('');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// RENDER: TRANSACTION LIST
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderTransactions(txs) {
  const el = document.getElementById('activityList');
  if (!txs.length) {
    el.innerHTML = '<div class="loading-row">No transactions found for this address on OP_NET testnet</div>';
    return;
  }

  el.innerHTML = txs.map(tx => {
    const icon = tx.type === 'contract' ? 'ğŸ”—' : tx.type === 'receive' ? 'â†“' : 'â†‘';
    const dotClass = tx.type === 'contract' ? 'contract' : tx.type === 'receive' ? 'recv' : 'send';
    const amountClass = tx.type === 'receive' ? 'pos' : 'neg';
    const amountPrefix = tx.type === 'receive' ? '+' : '-';
    const title = tx.type === 'contract' ? 'Smart Contract Call (OP_NET)' :
                  tx.type === 'receive' ? 'Received Bitcoin' : 'Sent Bitcoin';
    const time = tx.timestamp ? new Date(tx.timestamp * 1000).toLocaleDateString() : 'Unknown time';

    return `
      <div class="activity-row">
        <div class="activity-dot ${dotClass}">${icon}</div>
        <div class="activity-info">
          <div class="activity-title">${title}</div>
          <div class="activity-desc">${shortTxid(tx.txid)}</div>
        </div>
        <div class="activity-meta">
          <div class="activity-amount ${amountClass}">${amountPrefix}${tx.amount} BTC</div>
          <div class="activity-time">${time}</div>
        </div>
      </div>
    `;
  }).join('');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// COPILOT CHAT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ANSWERS = {
  'What are OP_20 tokens?': `OP_20 is the token standard on OP_NET â€” think of it like ERC-20 on Ethereum, but native to <span class="highlight">Bitcoin Layer 1</span>.\n\nUnlike BRC-20 or Runes (where indexers can disagree on balances), OP_20 uses <span class="good">cryptographic proof</span> â€” every node must arrive at exactly the same result. No disputes, no double-counting, no indexer drama.`,
  'How does OP_NET verify transactions?': `OP_NET uses a dual-layer system called <span class="highlight">Proof of Calculation (PoC)</span> + <span class="highlight">Proof of Validation (PoV)</span>.\n\nEvery node independently recalculates from Bitcoin's raw data. If two nodes arrive at different results â€” that's a bug, not a feature. The math forces agreement. <span class="good">This is what makes OP_NET fundamentally different from other Bitcoin meta-protocols.</span>`,
  'What is a Taproot address?': `Taproot (addresses starting with <span class="highlight">bc1p</span> or <span class="highlight">tb1p</span> on testnet) is Bitcoin's newest and most advanced address type.\n\nIt offers more <span class="good">privacy</span> (complex transactions look the same as simple ones), lower fees, and is required for OP_NET smart contract interactions. Think of it as the "modern standard" for Bitcoin.`,
};

function clearChat() {
  document.getElementById('chatMessages').innerHTML = '';
}

function addMsg(role, text) {
  const c = document.getElementById('chatMessages');
  const div = document.createElement('div');
  div.className = `msg ${role}`;
  div.innerHTML = `
    <div class="msg-avatar">${role === 'bot' ? 'â‚¿' : 'ğŸ‘¤'}</div>
    <div class="msg-bubble">${text.replace(/\n/g, '<br>')}</div>
  `;
  c.appendChild(div);
  c.scrollTop = c.scrollHeight;
}

function showTyping() {
  const c = document.getElementById('chatMessages');
  const div = document.createElement('div');
  div.id = 'typing'; div.className = 'msg bot';
  div.innerHTML = `<div class="msg-avatar">â‚¿</div><div class="msg-bubble"><div class="typing"><span></span><span></span><span></span></div></div>`;
  c.appendChild(div);
  c.scrollTop = c.scrollHeight;
}
function hideTyping() { document.getElementById('typing')?.remove(); }

function askQ(q) {
  addMsg('user', q);
  showTyping();
  setTimeout(() => {
    hideTyping();
    addMsg('bot', ANSWERS[q] || `Great question! I'm still learning about "${q}" in the context of OP_NET. Check the official docs at docs.opnet.org for the most current info.`);
  }, 800);
}

function sendMsg() {
  const input = document.getElementById('chatInput');
  const val = input.value.trim();
  if (!val) return;
  input.value = '';
  askQ(val);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// DEMO: Load a sample address (useful when no testnet address is handy)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loadDemo() {
  // This is the example address from OP_NET's own documentation
  document.getElementById('addressInput').value = 'tb1pth90usc4f528aqphpjrfkkdm4vy8hxnt5gps6aau2nva6pxeshtqqzlt3a';
  analyzeWallet();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// HELPERS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function shortAddr(addr) { return addr.slice(0, 8) + '...' + addr.slice(-6); }
function shortTxid(txid) { return txid ? txid.slice(0, 12) + '...' + txid.slice(-8) : ''; }

function setLoading(on) {
  document.getElementById('analyzeBtn').disabled = on;
  document.getElementById('analyzeBtn').textContent = on ? 'Loading...' : 'Analyze â†’';
}

function showError(msg) {
  const el = document.getElementById('errorBanner');
  el.textContent = 'âš  ' + msg;
  el.style.display = 'block';
}
function hideError() { document.getElementById('errorBanner').style.display = 'none'; }
</script>
</body>
</html>
